# テンプレート設計ガイド

本ツールキットで使用する PowerPoint テンプレートの設計・作成方法を解説します。

---

## 目次

1. [スライドマスターの基礎](#スライドマスターの基礎)
2. [推奨レイアウト構成](#推奨レイアウト構成)
3. [プレースホルダの設計](#プレースホルダの設計)
4. [配色とフォント](#配色とフォント)
5. [テンプレート作成手順](#テンプレート作成手順)
6. [本ツールキットとの連携](#本ツールキットとの連携)
7. [トラブルシューティング](#トラブルシューティング)

---

## スライドマスターの基礎

### 階層構造を理解する

PowerPoint のデザインは 3 層構造になっています：

```
┌─────────────────────────────────────────────────────────────┐
│  PPTX ファイル                                              │
│  └─ スライドマスター（Slide Master）                        │
│       ├─ テーマカラー、フォント、背景を一括定義             │
│       │                                                     │
│       └─ スライドレイアウト（Slide Layout）× 複数           │
│            ├─ [0] Title Slide         ← タイトル用          │
│            ├─ [1] Title and Content   ← 本文用              │
│            ├─ [2] Section Header      ← セクション区切り    │
│            ├─ [3] Two Content         ← 2列レイアウト       │
│            ├─ [4] Comparison          ← 比較用              │
│            ├─ [5] Title Only          ← タイトルのみ        │
│            ├─ [6] Blank               ← 白紙                │
│            └─ [n] カスタムレイアウト  ← 必要に応じて追加    │
└─────────────────────────────────────────────────────────────┘
```

### なぜスライドマスターが重要？

| メリット                   | 説明                                                   |
| -------------------------- | ------------------------------------------------------ |
| **一括デザイン変更**       | マスターを編集すると、全スライドに即座に反映           |
| **一貫性の確保**           | 同じレイアウトを使えば、フォント・色・位置が統一される |
| **プレースホルダの恩恵**   | 正しい枠に入力すると、自動でサイズ調整・位置揃えが効く |
| **本ツールキットとの相性** | `create_from_template.py` がレイアウトを自動選択できる |

### PowerPoint でマスターを開く方法

1. **表示** タブ → **スライドマスター** をクリック
2. 左ペインの一番上が「スライドマスター」、その下が個別の「レイアウト」
3. 編集後は **マスター表示を閉じる** で通常画面に戻る

---

## 推奨レイアウト構成

### 最小構成（4 レイアウト）

シンプルなプレゼンなら、以下の 4 つで十分です：

| レイアウト名          | 用途             | プレースホルダ         |
| --------------------- | ---------------- | ---------------------- |
| **Title Slide**       | 最初のスライド   | CENTER_TITLE, SUBTITLE |
| **Title and Content** | 本文（箇条書き） | TITLE, BODY            |
| **Section Header**    | セクション区切り | TITLE（大きめ）        |
| **Blank**             | 自由配置用       | なし                   |

### 推奨構成（8-10 レイアウト）

企業プレゼンや技術発表なら、以下を追加：

| レイアウト名                  | 用途                      | プレースホルダ                |
| ----------------------------- | ------------------------- | ----------------------------- |
| **Agenda**                    | 目次ページ                | TITLE, BODY（番号リスト向け） |
| **Two Content**               | 2 列比較                  | TITLE, BODY × 2               |
| **Title and Content (Photo)** | 画像 + テキスト           | TITLE, BODY, PICTURE          |
| **Code / Developer**          | コード表示用              | TITLE, BODY（等幅フォント）   |
| **Quote**                     | 引用・強調                | BODY（中央配置、大きめ）      |
| **Closing**                   | 最終スライド（Thank You） | CENTER_TITLE, SUBTITLE        |

### レイアウト命名のベストプラクティス

`analyze_template.py` がレイアウト名からタイプを自動判定します。以下のキーワードを含めると認識されやすくなります：

| タイプ       | 推奨キーワード                              |
| ------------ | ------------------------------------------- |
| `title`      | "Title Slide", "タイトル スライド"          |
| `content`    | "Title and Content", "タイトルとコンテンツ" |
| `section`    | "Section", "セクション"                     |
| `agenda`     | "Agenda", "アジェンダ", "目次"              |
| `closing`    | "Closing", "クロージング", "End"            |
| `two_column` | "Two Content", "Two Column", "2 列"         |
| `code`       | "code", "Code", "Developer", "コード"       |
| `photo`      | "Photo", "Image", "Picture", "50/50"        |
| `blank`      | "Blank", "白紙"                             |

> 💡 キーワードは大文字・小文字を区別しません（"code" も "Code" も同じに認識）

---

## プレースホルダの設計

### プレースホルダとは

プレースホルダは「ここにタイトルを入れてね」「ここに本文を入れてね」という入力枠です。固定テキストボックスとは異なり、以下の利点があります：

- フォントサイズの自動調整
- テキスト量に応じた縮小
- 本ツールキットからの自動検出

### プレースホルダの種類

| タイプ         | 用途                   | PowerPoint での名称   |
| -------------- | ---------------------- | --------------------- |
| `CENTER_TITLE` | タイトルスライドの題名 | タイトル（中央）      |
| `TITLE`        | 通常スライドの見出し   | タイトル              |
| `SUBTITLE`     | サブタイトル           | サブタイトル          |
| `BODY`         | 本文（箇条書き）       | コンテンツ / テキスト |
| `CONTENT`      | 汎用コンテンツ         | コンテンツ            |
| `PICTURE`      | 画像用                 | 図                    |
| `CHART`        | グラフ用               | グラフ                |
| `TABLE`        | 表用                   | 表                    |
| `FOOTER`       | フッター               | フッター              |
| `SLIDE_NUMBER` | スライド番号           | スライド番号          |
| `DATE`         | 日付                   | 日付                  |

### プレースホルダの追加方法

1. スライドマスター表示で対象レイアウトを選択
2. **スライドマスター** タブ → **プレースホルダーの挿入** → 種類を選択
3. ドラッグしてサイズ・位置を設定
4. 必要に応じてフォント・配置を調整

### 配置のガイドライン

```
┌────────────────────────────────────────────────────────────────┐
│  ← 0.5" →                                        ← 0.5" →     │
│  ┌──────────────────────────────────────────────────────┐     │
│  │  TITLE プレースホルダ                                │  ↑  │
│  │  高さ: 0.8-1.0"                                      │ 0.5"│
│  └──────────────────────────────────────────────────────┘  ↓  │
│                                                                │
│  ┌──────────────────────────────────────────────────────┐     │
│  │                                                      │     │
│  │  BODY プレースホルダ                                 │     │
│  │  高さ: 4.5-5.0"                                      │     │
│  │                                                      │     │
│  │  ※ 箇条書き 5-8 項目が収まるサイズ                  │     │
│  │                                                      │     │
│  └──────────────────────────────────────────────────────┘     │
│                                                          ↑     │
│  ┌──────────────────────────────────────────────────────┐0.4" │
│  │  FOOTER / SLIDE_NUMBER（オプション）                 │ ↓   │
│  └──────────────────────────────────────────────────────┘     │
└────────────────────────────────────────────────────────────────┘
        16:9 (13.33" × 7.5") の場合
```

### ⚠️ 避けるべきパターン

| NG パターン                      | 理由                                       |
| -------------------------------- | ------------------------------------------ |
| 固定テキストボックスで本文を書く | スクリプトで正しく検出されない             |
| プレースホルダを小さくしすぎる   | テキストがオーバーフローする               |
| FOOTER/DATE を本文領域に重ねる   | 自動除外されず、置換対象になってしまう     |
| 複数の BODY を同じレイアウトに   | どちらに入るか不明確（Two Content は例外） |

---

## 配色とフォント

### 配色設計

#### テーマカラーの構成

PowerPoint のテーマカラーは 12 色で構成されます：

| 番号 | 用途                | 推奨                          |
| ---- | ------------------- | ----------------------------- |
| 1-2  | 背景色（明/暗）     | 白 `#FFFFFF` / 濃紺 `#1E1E1E` |
| 3-4  | テキスト色（明/暗） | 黒 `#000000` / 白 `#FFFFFF`   |
| 5-6  | アクセント 1-2      | ブランドカラー                |
| 7-10 | アクセント 3-6      | 補助色（グラフ・図形用）      |
| 11   | ハイパーリンク      | 青系                          |
| 12   | 訪問済みリンク      | 紫系                          |

#### コントラスト比

WCAG 2.1 に準拠するため、以下のコントラスト比を確保：

| 用途           | 最低コントラスト比 | 推奨                   |
| -------------- | ------------------ | ---------------------- |
| 本文テキスト   | 4.5:1              | 黒文字 on 白背景       |
| 大きなテキスト | 3:1                | タイトルなど 18pt 以上 |
| 図形・グラフ   | 3:1                | 隣接色との差           |

> 💡 コントラストチェッカー: https://webaim.org/resources/contrastchecker/

#### 明暗両対応のコツ

```
明るい背景（白系）
├─ テキスト: ダークグレー (#333333) または 黒 (#000000)
├─ 見出し: ブランドカラー（濃い色）
└─ アクセント: 彩度高めの色

暗い背景（ダーク系）
├─ テキスト: 白 (#FFFFFF) または ライトグレー (#E0E0E0)
├─ 見出し: 明るいアクセントカラー
└─ アクセント: 彩度を抑えた明るめの色
```

### フォント設計

#### 推奨フォント

| 環境             | 欧文フォント            | 和文フォント                |
| ---------------- | ----------------------- | --------------------------- |
| **Windows 標準** | Segoe UI, Arial         | Yu Gothic UI, Meiryo UI     |
| **Mac 互換**     | Arial, Helvetica        | Hiragino Sans               |
| **デザイン重視** | 自由（埋め込み注意）    | BIZ UDPGothic, Noto Sans JP |
| **コード表示**   | Consolas, Cascadia Code | （欧文のみで OK）           |

#### フォントサイズの目安

| 要素             | 推奨サイズ | 最小サイズ |
| ---------------- | ---------- | ---------- |
| タイトル（表紙） | 44-60 pt   | 36 pt      |
| スライド見出し   | 28-36 pt   | 24 pt      |
| 本文（箇条書き） | 18-24 pt   | 16 pt      |
| サブテキスト     | 14-16 pt   | 12 pt      |
| フッター・注釈   | 10-12 pt   | 8 pt       |

#### ⚠️ フォント埋め込みの注意

- **埋め込むと**: ファイルサイズ増加、ライセンス問題の可能性
- **埋め込まないと**: 相手の環境にフォントがないと代替フォントになる
- **推奨**: Windows 標準フォントを使い、埋め込まない

---

## テンプレート作成手順

### Step 1: スライドサイズの設定

1. **デザイン** タブ → **スライドのサイズ** → **ユーザー設定のスライドのサイズ**
2. **ワイドスクリーン (16:9)** を選択（13.333" × 7.5"）
3. 既存コンテンツがある場合は「最大化」を選択

### Step 2: スライドマスターを開く

1. **表示** タブ → **スライドマスター**
2. 左ペインの一番上（大きいサムネイル）がマスター本体

### Step 3: テーマカラーの設定

1. マスター本体を選択した状態で **配色** → **色のカスタマイズ**
2. 12 色を設定（[配色設計](#配色設計) 参照）
3. 名前を付けて保存（例: "MyCompany Theme"）

### Step 4: フォントの設定

1. **フォント** → **フォントのカスタマイズ**
2. 見出し用・本文用フォントを設定
3. 名前を付けて保存

### Step 5: レイアウトの作成

1. 不要な既存レイアウトを削除（右クリック → 削除）
2. 必要なレイアウトを追加（**レイアウトの挿入**）
3. 各レイアウトに名前を付ける（わかりやすい英語名推奨）
4. プレースホルダを配置

### Step 6: 各レイアウトの設計

#### Title Slide（タイトル）

```
┌────────────────────────────────────────────────────────────────┐
│                                                                │
│                                                                │
│            ┌────────────────────────────────┐                  │
│            │     CENTER_TITLE               │                  │
│            │     44-60pt, 中央揃え          │                  │
│            └────────────────────────────────┘                  │
│            ┌────────────────────────────────┐                  │
│            │     SUBTITLE                   │                  │
│            │     20-24pt, 中央揃え          │                  │
│            └────────────────────────────────┘                  │
│                                                                │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

#### Title and Content（本文）

```
┌────────────────────────────────────────────────────────────────┐
│  ┌──────────────────────────────────────────────────────┐     │
│  │  TITLE: 28-36pt                                      │     │
│  └──────────────────────────────────────────────────────┘     │
│  ┌──────────────────────────────────────────────────────┐     │
│  │  BODY: 18-24pt                                       │     │
│  │  • 箇条書き項目 1                                    │     │
│  │  • 箇条書き項目 2                                    │     │
│  │    - サブ項目                                        │     │
│  │  • 箇条書き項目 3                                    │     │
│  └──────────────────────────────────────────────────────┘     │
└────────────────────────────────────────────────────────────────┘
```

#### Two Content（2 列）

```
┌────────────────────────────────────────────────────────────────┐
│  ┌──────────────────────────────────────────────────────┐     │
│  │  TITLE                                               │     │
│  └──────────────────────────────────────────────────────┘     │
│  ┌─────────────────────┐    ┌─────────────────────┐          │
│  │  BODY (左)          │    │  BODY (右)          │          │
│  │  • 項目 1           │    │  • 項目 A           │          │
│  │  • 項目 2           │    │  • 項目 B           │          │
│  └─────────────────────┘    └─────────────────────┘          │
└────────────────────────────────────────────────────────────────┘
```

#### Section Header（セクション区切り）

```
┌────────────────────────────────────────────────────────────────┐
│                                                                │
│                                                                │
│            ┌────────────────────────────────┐                  │
│            │     TITLE                      │                  │
│            │     36-44pt, 中央 or 左揃え    │                  │
│            │     背景色を変えると効果的     │                  │
│            └────────────────────────────────┘                  │
│                                                                │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### Step 7: 保存とテスト

1. **マスター表示を閉じる**
2. **ファイル** → **名前を付けて保存** → `.pptx` 形式で保存
3. `templates/` フォルダに配置
4. `analyze_template.py` でレイアウト認識をテスト

```powershell
python scripts/analyze_template.py templates/mytemplate.pptx
```

---

## 本ツールキットとの連携

### analyze_template.py の出力を確認

```powershell
python scripts/analyze_template.py templates/mytemplate.pptx
```

出力例：

```
============================================================
Template: mytemplate.pptx
Path: templates/mytemplate.pptx
Size: 13.33" x 7.5" (16:9)
============================================================

━━━ Slide Masters (1) ━━━
  [0] Master_0: 12 layouts

━━━ Layouts (12) ━━━
  [ 0] Title Slide          category=title    [TITLE, BODY]
  [ 1] Title and Content    category=content  [TITLE, OBJECT]
  [ 2] Section Header       category=section  [TITLE]
  [ 3] Two Content          category=two_column [TITLE, OBJECT, OBJECT]
  [ 4] Picture with Caption category=photo    [TITLE, BODY, PICTURE]
  [ 5] Blank                category=blank    []
  ...

📋 Recommended Layout Mapping:
----------------------------------------
  title           → [ 0] Title Slide
  content         → [ 1] Title and Content
  section         → [ 2] Section Header
  agenda          → [ 1] Title and Content
  summary         → [ 1] Title and Content
  closing         → [ 2] Section Header
  two_column      → [ 3] Two Content
  code            → [ 1] Title and Content
  photo           → [ 4] Picture with Caption
  blank           → [ 5] Blank

✅ Saved: output_manifest/mytemplate_layouts.json
```

> 📝 実際の出力はテンプレートに応じて変わります。詳細なレイアウト情報（`has_title`, `has_picture` 等）も含まれます。

### layouts.json のカスタマイズ

自動検出が期待通りでない場合、`layouts.json` を手動編集：

```json
{
  "template": "mytemplate.pptx",
  "layout_mapping": {
    "title": 0,
    "content": 1,
    "section": 2,
    "agenda": 1,
    "summary": 1,
    "closing": 6,
    "two_column": 3,
    "code": 7,
    "photo": 4,
    "blank": 5
  }
}
```

### content.json でのレイアウト指定

`type` でスライドタイプを指定するか、`layout` で直接番号を指定：

```json
{
  "slides": [
    { "type": "title", "title": "発表タイトル", "subtitle": "サブタイトル" },
    { "type": "agenda", "title": "目次", "items": ["項目1", "項目2", "項目3"] },
    {
      "type": "content",
      "title": "本文スライド",
      "items": ["箇条書き1", "箇条書き2"]
    },
    {
      "type": "code",
      "title": "コードスライド",
      "code": "print('Hello, World!')"
    },
    { "type": "closing", "title": "Thank You" }
  ]
}
```

---

## トラブルシューティング

### レイアウトが正しく認識されない

**症状**: `analyze_template.py` が想定と違うレイアウトを選ぶ

**対処**:

1. レイアウト名にキーワードを含める（"Title Slide", "Section" など）
2. `layouts.json` を手動で編集
3. `content.json` で `"layout": N` を直接指定

### プレースホルダにテキストが入らない

**症状**: 本文が入力されない、タイトルだけ表示される

**対処**:

1. レイアウトに BODY または CONTENT プレースホルダがあるか確認
2. プレースホルダが「テキスト」タイプになっているか確認
3. 別のレイアウトを試す

### フォントが変わってしまう

**症状**: 作成した PPTX を別 PC で開くとフォントが違う

**対処**:

1. Windows 標準フォント（Segoe UI, Arial, Yu Gothic UI）を使用
2. フォントを埋め込む（ファイルサイズ増加に注意）
3. PDF で配布する

### 色がおかしい

**症状**: スライドマスターと違う色になる

**対処**:

1. テーマカラーを使用しているか確認（直接色指定していないか）
2. マスター本体ではなく、個別レイアウトで色を変えていないか確認
3. 本ツールキットのスクリプトは基本的にテーマカラーを継承する

### 日本語が見切れる

**症状**: 英語では収まるが、日本語にすると溢れる

**対処**:

1. プレースホルダを大きめに設計（英語の 1.3-1.5 倍の領域）
2. フォントの自動縮小を有効にする
3. 文字数制限を厳しくする（README のガイドライン参照）

---

## 参考リソース

- [Microsoft: スライド マスターとは](https://support.microsoft.com/ja-jp/office/スライド-マスターとは-b9abb2a0-7aef-4257-a14e-4329c904da54)
- [python-pptx Documentation](https://python-pptx.readthedocs.io/)
- [WCAG 2.1 コントラスト比](https://www.w3.org/WAI/WCAG21/Understanding/contrast-minimum.html)
