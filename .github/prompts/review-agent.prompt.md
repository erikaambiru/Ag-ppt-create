# Prompt: Refactor Agent Definition

既存のエージェント定義 (`.agent.md`) またはワークフロー全体をレビューし、設計原則に基づいてリファクタリングするためのプロンプトです。

## 前提条件

- 参照: `.github/instructions/agent-design.instructions.md`
- 参照: `AGENTS.md` (エージェント一覧と役割定義)

---

## レビュー観点チェックリスト

対象のエージェント定義・ワークフローに対して、以下の **10 観点** でチェックを行ってください。

### ■ 1. ゴールの明確さ (Goal Clarity)

- ワークフローの最終成果物は何か？
- 達成手段が冗長になっていないか？
- 完了条件は具体的かつ検証可能か？

### ■ 2. エージェントの責務分割 (Single Responsibility)

- 1 エージェントが複数の責務を持っていないか？
- 分割すべき、または統合すべき部分はどこか？
- 例: 計画と実装が混在している → 分離を検討

### ■ 3. 入力 / 出力の契約 (I/O Contract)

- エージェント間の受け渡し仕様（ファイルパス、フォーマット）は明確か？
- 曖昧な状態・非決定性が生じないか？
- 成果物の検証方法は定義されているか？

### ■ 4. ステート管理と依存関係 (State & Dependencies)

- ファイル・変数・メモリ管理は適切か？
- 依存サイクル（循環参照）が発生していないか？
- 過去の会話履歴に依存せず、現状（ファイル・Issue 等）を見て判断する設計か？

### ■ 5. 冪等性 (Idempotency)

- 何度実行しても同じ結果が得られる設計になっているか？
- 例: 「追記する」ではなく「存在確認してから追記する」ロジック

### ■ 6. エラーハンドリング (Error Handling)

- 失敗時のフォールバック手段はあるか？
- リトライ回数の上限は設定されているか？
- 手戻りのない構造（ロールバック可能）になっているか？

### ■ 7. パフォーマンス最適化 (Performance)

- 明らかに無駄なチャット往復、外部ツール呼び出しがないか？
- 並列実行可能なタスクを直列にしていないか？

### ■ 8. 人間介入ポイント (Human-in-the-loop)

- 破壊的操作（削除、強制上書き、デプロイ等）前に確認を求めるか？
- 承認が必要なステップは明示されているか？

### ■ 9. 可観測性 (Observability)

- エージェントの思考プロセスや決定事項がログとして残るか？
- 長時間タスクでの進捗報告（Todo リスト消化状況等）はあるか？

### ■ 10. セキュリティ境界 (Security Boundary)

- 機密情報（API キー、パスワード）の取り扱いは適切か？
- 外部 API 呼び出しや `git push` の制限は設けられているか？

---

## 指示

1. 上記チェックリストに基づいて **問題点を指摘** してください。
2. 改善された `.agent.md` の内容を提示してください。
3. エージェントの役割やファイル名が変更になる場合は、`AGENTS.md` の更新内容も合わせて提示してください。
4. ワークフロー全体のレビューの場合は、改善後のフロー図（Mermaid 等）も提示してください。

---

## 出力フォーマット

### 問題点サマリ

| #   | 観点 | 問題 | 重大度          |
| --- | ---- | ---- | --------------- |
| 1   | ...  | ...  | High/Medium/Low |

### 改善後のエージェント定義

```markdown
# [Agent Name]

## Role

...

## Goals

...

## Permissions

...

## Workflow

...
```
