# PLAN フェーズ確認プロセス

**PPTX 生成を始める前に、必ずユーザーに確認を取る。勝手に進めない。**

---

## 確認すべき項目（Web/ブログソース）

1. **詳しさ/枚数**: 詳細版 / 標準版 / 要約版
2. **テンプレート**: 下記「テンプレート選択肢」から選択
3. **画像取り込み**: 全て（推奨）/ 主要のみ / なし
4. **コードブロック**: 含める（推奨）/ 含めない ★ 技術記事の場合

### ⚠️ PLAN 前の必須確認（Web ソース）

PLAN フェーズ開始時に、以下の構成要素を事前確認すること：

| 確認項目             | 確認方法                            | 対応                                               |
| -------------------- | ----------------------------------- | -------------------------------------------------- |
| 画像の有無           | `curl -s $url` で `<img` タグを確認 | 画像あり → 取得手順を提示                          |
| コードブロックの有無 | `<pre><code>` タグを確認            | コードあり → content.json に `code` フィールド追加 |
| 記事の長さ           | 文字数または見出し数を確認          | 枚数の目安を算出                                   |

**重要**: `fetch_webpage` は画像 URL を返さない場合がある。別途 `curl` で HTML ソースを取得して確認すること。

---

## 確認すべき項目（PPTX 入力）

### 聞くべきこと

| 質問                 | 選択肢                                                                    |
| -------------------- | ------------------------------------------------------------------------- |
| **Q1: 枚数**         | そのまま / 2/3 / 1/2 / 1/4 / カスタム指定                                 |
| **Q2: デザイン方式** | 元 PPTX 継承（デフォルト）/ テンプレート指定 / pptxgenjs / create_ja_pptx |

---

## 📝 デザイン方式（全ソース共通）★ 必ず表示

> 💡 **統一ルール**: A〜C + テンプレート(D〜) は全ソース共通。A は PPTX 入力時のみ表示。

### 共通の生成方式（A〜C）

| #     | 方式               | 特徴                                                               | 表示条件               |
| ----- | ------------------ | ------------------------------------------------------------------ | ---------------------- |
| **A** | **元 PPTX 継承**   | 元 PPTX のマスター（色・フォント・背景）をそのまま使用             | ⚠️ **PPTX 入力時のみ** |
| **B** | **pptxgenjs**      | JavaScript でカスタム生成、コードブロック・**構成図/ポンチ絵**対応 | 常に表示               |
| **C** | **create_ja_pptx** | 白紙からシンプルに生成（python-pptx）                              | 常に表示               |

### テンプレートを使用する方式（D〜）★ 動的取得必須

> 🚨 **重要**: PLAN フェーズでは**必ず**以下のコマンドでテンプレートを取得し、D〜の表に展開すること

```powershell
# ★ PLANフェーズ開始時に必ず実行
Get-ChildItem -Path "templates" -Filter "*.pptx" | Select-Object -ExpandProperty Name
```

**取得したテンプレートを D, E, F... の順に割り当てて表示:**

| #   | 方式                       | 説明                       | 表示条件 |
| --- | -------------------------- | -------------------------- | -------- |
| D   | （1 番目のテンプレート名） | ファイル名をそのまま表示   | 常に表示 |
| E   | （2 番目のテンプレート名） | ファイル名をそのまま表示   | 常に表示 |
| F〜 | （以降同様）               | アルファベット順で自動割当 | 常に表示 |

**例**: テンプレート 4 個の場合 → D, E, F, G に割り当て

```
# 取得結果の例:
sample-ppf.pptx              → D
Security - IgniteUpdate.pptx → E
template.pptx                → F
入力業務のルールについて.pptx → G
```

### ⚠️ 実験的な方式（非推奨）

| 方式         | 特徴                                             | 状態                            |
| ------------ | ------------------------------------------------ | ------------------------------- |
| **preserve** | 既存シェイプを直接編集して翻訳（図・グラフ維持） | ⭐⭐ experimental（精度改善中） |

> 📝 `preserve` 方式は図やグラフを維持したまま翻訳できる可能性がありますが、レイアウト崩れが発生しやすいため現在は **reconstruct（元 PPTX 継承）方式を推奨**しています。

### 🎯 おすすめの組み合わせ

| ソース種別               | 推奨パターン            | 説明                 |
| ------------------------ | ----------------------- | -------------------- |
| **PPTX 入力**            | **A（元 PPTX 継承）**   | デザイン継承が安定   |
| **コード多めの技術記事** | **B（pptxgenjs）**      | コードブロック対応   |
| **構成図/ポンチ絵**      | **B（pptxgenjs）**      | 図形・矢印・色分け   |
| **Web/ブログ記事**       | **D〜（テンプレート）** | 比較して好みを選べる |
| **シンプルに作りたい**   | **C（create_ja_pptx）** | ミニマルなデザイン   |

### ⚠️ テンプレート選択時の注意（★ 重要）

外部テンプレートを使用する場合、以下の問題が発生する可能性があります：

| 問題                              | 症状                                   | 対処                    |
| --------------------------------- | -------------------------------------- | ----------------------- |
| **暗い背景レイアウト**            | テキストが読めない（コントラスト不足） | 元 PPTX 継承（A）を使用 |
| **タイトル幅が狭い**              | 長いタイトルが 3-4 行に折り返し        | 元 PPTX 継承（A）を使用 |
| **プレースホルダーなし**          | テキスト配置ができない                 | 別のレイアウトを指定    |
| **タイトル/サブタイトル離れすぎ** | スカスカに見える                       | 自動修正あり            |

**推奨**: PPTX 入力時は**方式 A（元 PPTX 継承）がデフォルト**。テンプレートを使う場合は事前に `diagnose_template.py` で診断。

```powershell
# テンプレート診断
python scripts/diagnose_template.py templates/xxx.pptx
```

> 💡 「両方」「全部」と指定すると複数テンプレートで生成します

### 内部処理の自動選択（ユーザーには聞かない）

| 枚数選択 | 自動適用される処理                    |
| -------- | ------------------------------------- |
| そのまま | `reconstruct` → 1:1 翻訳 or 軽い統合  |
| それ以外 | `summarize` → AI が内容理解して再構成 |

---

## デフォルト動作

**ユーザーが選択肢を指定せず「お任せ」と言った場合:**

- **英語版 PPTX**: 選択肢 1（そのまま全翻訳）を提案
- **Web/ブログ**: 選択肢 2（標準版）を提案

> ※ 提案後もユーザー確認を得てから生成を開始します。

---

## 提案フォーマット例（Web/ブログソース）

```
## 📋 生成プラン確認

**入力**: [記事タイトル]
**ソース**: [URL]

---

### 🎯 枚数・詳しさ

| # | 枚数 | 詳しさ | 画像 | 説明 |
|---|------|--------|------|------|
| **1** | 6-8枚 | 要約版 | 主要2枚 | ポイントだけ簡潔に |
| **2** | 10-14枚 | 標準版 | 主要4-5枚 | バランス重視（推奨） |
| **3** | 16-25枚 | 詳細版 | 全て | 手順を丁寧に説明 |

---

### 📝 生成方式の選択

| # | 方式 | 特徴 | 向いている用途 |
|---|------|------|---------------|
| **B** | **pptxgenjs** | JavaScriptでカスタム生成、コードブロック対応 | コード例が多い技術資料 |
| **C** | **create_ja_pptx** | 白紙からシンプルに生成（python-pptx） | ミニマルなデザイン希望時 |
| **D〜** | **（テンプレート名を動的表示）** | ★上記コマンドで取得したテンプレートを展開 | 一般的なプレゼン |

> 🎯 **おすすめ**: 標準版（2） + 最初のテンプレート（D）

---

**どれにしますか？**（枚数 + 方式で指定）

例:
- 「2D」→ 標準版、最初のテンプレートで生成
- 「2E」→ 標準版、2番目のテンプレートで生成
- 「2B」→ 標準版、pptxgenjs（コードブロック対応）
- 「3C」→ 詳細版、create_ja_pptx（ミニマルデザイン）
- 「2 全部」→ 標準版、全テンプレートで比較
```

---

## 提案フォーマット例（PPTX 入力）★ 改善版

```
## 📋 PPTX 日本語化プラン

**入力**: [ファイル名]
**検出**: PPTX（{N}枚）

### 📊 分析結果
| 種別 | 枚数 |
|------|------|
| タイトルスライド | {N}枚 |
| コンテンツスライド | {N}枚 |
| 画像を含むスライド | {N}枚 |

---

### 🎯 枚数・圧縮率

| # | 出力枚数 | 圧縮率 | 説明 |
|---|----------|--------|------|
| **1** | {N}枚 | そのまま | 完全版が必要な場合 |
| **2** | {N×2/3}枚 | 2/3 | 類似スライド統合 |
| **3** | {N×1/2}枚 | 1/2 | 半分に圧縮 |
| **4** | {N×1/4}枚 | 1/4 | 要点に絞る |

> 💡 カスタム指定もOK（例:「50枚で」「1/3で」）

---

### 📝 デザイン方式の選択

| # | 方式 | 特徴 | 向いている資料 |
|---|------|------|---------------|
| **A** | **元PPTX継承** | 元PPTXのマスター（色・フォント・背景）をそのまま使用 | 通常のプレゼン資料（デフォルト） |
| **B** | **pptxgenjs** | JavaScriptでカスタム生成。コードブロック対応 | コード例が多い技術資料 |
| **C** | **create_ja_pptx** | 白紙からシンプルに生成（python-pptx） | ミニマルなデザイン希望時 |
| **D〜** | **（テンプレート名を動的表示）** | ★上記コマンドで取得したテンプレートを展開 | 自社テンプレートを使いたい場合 |

> ⚠️ **注意**: 元PPTX継承・テンプレートともに、**スライドマスターが正しく設定されている**必要があります。

> 🚨 **D〜の表示ルール**: `Get-ChildItem -Path "templates" -Filter "*.pptx"` で取得した結果を D, E, F... に展開して具体的なファイル名を表示すること。「templates/*.pptx」のような抽象表記は禁止。

---

**どれにしますか？**（枚数 + 方式で指定、デフォルト: 1A）

例:
- 「1A」→ 全スライド忠実翻訳（元PPTX継承）
- 「1」→ 全スライド忠実翻訳（デフォルト: 元PPTX継承）
- 「3A」→ 1/2に圧縮（元PPTX継承）
- 「1B」→ 全スライド、コードブロック対応（pptxgenjs）
- 「2D」→ 2/3圧縮、最初のテンプレート使用
- 「50枚で」→ 50枚に調整
```

---

## 処理方式の説明（参考情報）

ユーザーから聞かれた場合のみ説明する。通常は内部で自動選択。

| 方式            | 説明                                              | 使用場面                 |
| --------------- | ------------------------------------------------- | ------------------------ |
| **reconstruct** | 元 PPTX からコンテンツ抽出 → マスター継承で再構成 | 枚数維持〜軽い統合       |
| **summarize**   | AI が全体を理解して要約・再構成                   | 1/2 以下に圧縮           |
| **pptxgenjs**   | JavaScript でカスタム生成                         | コードブロックが多い資料 |

---

**確認なしに BUILD まで進めることは禁止。**
