# 品質ガイドライン

## 出典表記ルール（★ 重要）

既存の PPTX から新規 PPTX を生成する場合、**スピーカーノートに元スライド番号を記載**。

### 自動追加（reconstruct 方式）

`reconstruct_analyzer.py` が各スライドのノートに自動追加：

```
[出典: 元スライド #5]
```

### 手動作成・統合時のルール

| ケース                       | ノートに記載する内容                   |
| ---------------------------- | -------------------------------------- |
| 1 対 1 変換                  | `[出典: 元スライド #N]`                |
| 複数スライド統合             | `[出典: 元スライド #3, #4, #5]`        |
| 要約・再構成                 | `[出典: 元スライド #10-15 を基に要約]` |
| 新規追加（元にないスライド） | `[新規作成]`                           |

### 例（統合スライド）

```json
{
  "type": "content",
  "title": "Azure の主要サービス",
  "items": [
    { "text": "Compute: VM, AKS, Functions" },
    { "text": "Storage: Blob, Files, Queue" },
    { "text": "Database: SQL, Cosmos DB" }
  ],
  "notes": "元の3つのスライドを1つに統合しました。\n\n---\n[出典: 元スライド #8, #9, #10 を統合]"
}
```

## スライド構成ルール

1. **アジェンダ必須**: タイトルスライドの直後に必ず `type: "agenda"` を配置
2. **まとめ必須**: クロージング前に必ず Summary/まとめスライドを配置
3. **空スライド禁止**: スピーカーノートだけのスライド（本文なし）は生成しない
4. **最小コンテンツ**: `type: "content"` には必ず `items` または `bullets` が必要
5. **セクションスライドにはサブタイトル必須**: `type: "section"` には必ず `subtitle` を追加（空っぽに見える問題を防止）

### ⚠️ セクションスライドのルール（★ 重要）

**問題**: `type: "section"` でタイトルのみだと「空っぽに見える」

**推奨**: 必ず `subtitle` フィールドでセクションの概要を追加

```json
// ❌ NG: タイトルのみで空っぽに見える
{
  "type": "section",
  "title": "MCP サーバーの開発とデプロイ"
}

// ✅ OK: サブタイトルで概要を追加
{
  "type": "section",
  "title": "MCP サーバーの開発とデプロイ",
  "subtitle": "VS Code で開発し Azure Container App にデプロイ"
}
```

## 空スライドの除外

**以下のスライドは除外する:**

- スピーカーノートのみで本文・タイトルがないスライド
- 背景だけのスライド（デモ用スクリーンショット等）
- タイトルも箇条書きもないスライド

→ `reconstruct_analyzer.py` は自動検出して `type: "_empty"` とマークする

## オーバーフロー対策

1. **事前検証**: `check_overflow.py` で bbox 検証
2. **文字数制限**: タイトル 40 文字以内、箇条書き項目 80 文字以内を目安
3. **項目数制限**: 1 スライドあたり箇条書き 5-8 項目まで、内容に応じて 1 段落下げてもよい
4. **分割推奨**: 内容が多い場合はスライドを分割

## 画像サイズ適正化

| 元画像サイズ     | 推奨 width_percent | 備考         |
| ---------------- | ------------------ | ------------ |
| 大（1000px+）    | 40-50%             | 通常サイズ   |
| 中（500-1000px） | 30-40%             | やや小さめ   |
| 小（500px 未満） | 20-30%             | 拡大しない   |
| アイコン/ロゴ    | 15-25%             | 元サイズ維持 |

**重要**: 小さい画像を無駄に大きくしない（ぼやける）

**自動保護機能**:

- `create_from_template.py` は PIL で画像サイズを検出し、自然サイズの 150% を上限に自動制限
- ログに "(capped from X% to Y%)" と表示される場合は width_percent が制限された

## アイコン/ロゴの自動サイズ調整

以下の画像はアイコン/ロゴとして検出され、**適切な小さいサイズで配置**:

| 条件                                  | 推奨サイズ |
| ------------------------------------- | ---------- |
| 400px 未満（幅または高さ）            | 10-20%     |
| 正方形（0.9-1.1 比率）かつ 800px 以下 | 15-25%     |

## スクリーンショットスライドのルール

**コンテンツ（箇条書き）がないスライドでは画像を大きく表示:**

| スライドの内容               | 画像サイズ        | 説明の配置           |
| ---------------------------- | ----------------- | -------------------- |
| タイトル + 箇条書きあり      | 30-45% (右配置)   | 本文に記載           |
| タイトルのみ（箇条書きなし） | 60-80% (中央寄り) | **ノートに詳細記載** |
| 画像のみ（デモ画面等）       | 80-100% (フル)    | **ノートに詳細記載** |

### ⚠️ photo タイプの注意点（★ 重要）

**問題**: `type: "photo"` で画像だけのスライドを作ると「何を見せているかわからない」

**推奨**: photo タイプは **content タイプに変換**し、ノートから抽出した説明を追加

```json
// ❌ NG: 画像だけで何を見せているかわからない
{
  "type": "photo",
  "title": "DSPM ダッシュボード",
  "image": { "path": "images/slide_22.png", "position": "right", "width_percent": 45 }
}

// ✅ OK: 説明文を追加してわかりやすく
{
  "type": "content",
  "title": "DSPM ダッシュボード",
  "items": [
    "データセキュリティの簡素化",
    "主要なポスチャメトリクス",
    "目標（Objectives）の設定"
  ],
  "image": { "path": "images/slide_22.png", "position": "right", "width_percent": 50 }
}
```

**レイアウトの選択:**

| パターン                   | 推奨レイアウト         | 画像配置             |
| -------------------------- | ---------------------- | -------------------- |
| 説明文 + 画像              | Layout 3 (Content)     | `position: "right"`  |
| 画像中心（説明は最小限）   | Layout 12 (Title Only) | `position: "center"` |
| 画像のみ（フルスクリーン） | Layout 44 (Blank)      | `position: "full"`   |

**ポイント:**

- 短いタイトル（1 文）+ 大きな画像 + 詳細なノート
- 箇条書きを無理に入れない
- 画面操作の説明はノートに書く

## テンプレート選定

> 💡 `templates/` フォルダ内の `.pptx` ファイルを動的に取得して使用

| 用途               | 推奨テンプレート              | 備考                   |
| ------------------ | ----------------------------- | ---------------------- |
| 一般的なプレゼン   | `templates/` 内のテンプレート | 動的取得、先頭を推奨   |
| 元 PPTX の継承     | 元 PPTX 自体                  | reconstruct 方式で使用 |
| コード多め         | pptxgenjs で生成              | コードブロック対応     |
| シンプル・モノクロ | create_ja_pptx                | 最小限のスタイル       |

## スライド枚数計算ロジック

```
基本枚数 = タイトル(1) + アジェンダ(1) + コンテンツ + まとめ(1)
画像枚数 = 取得した主要画像の数
─────────────────────────────────
合計枚数 = 基本枚数 + 画像枚数
```

| ソース種別               | 画像なし目安 | 画像あり目安 | 目安の根拠        |
| ------------------------ | ------------ | ------------ | ----------------- |
| 短い記事（〜1500 字）    | 6-8 枚       | 10-14 枚     | 300 字/スライド   |
| 中程度（1500-4000 字）   | 10-14 枚     | 15-20 枚     | 手順数 ×1.5       |
| 長い技術記事（4000 字+） | 14-18 枚     | 20-30 枚     | セクション数 ×3-4 |
| 英語版 PPTX              | 元と同数     | 元と同数     | 1 対 1 マッピング |

**重要**: 画像が記事に含まれている場合、コンテンツスライドを減らすのではなく、**画像スライドを追加**する。
